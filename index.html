<!DOCTYPE html>

<head>

	<title>Testing</title>

	<script> // Check URL, load jQuery or Zepto
		var script=document.createElement("script");0>window.location.href.indexOf("zepto")?
		script.src="http://code.jquery.com/jquery-1.10.2.js":
		script.src="http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0/zepto.js";
		document.write(script.outerHTML);
	</script>

	<style>

		body {
			width: 400px;
			max-width: 100%;
			margin: 100px auto;
		}

		.noUi-target {
			margin: 80px;
		}
		.noUi-vertical {
			height: 150px;
		}

		section {
			border-bottom: 2px solid #888;
			margin-bottom: 80px;
			padding-bottom: 40px;
		}

		.tooltip {
			display: none;
			position: absolute;
			border: 1px solid #D9D9D9;
			font: 400 12px/12px Arial;
			border-radius: 3px;
			top: 40px;
			padding: 5px;
			left: 17px;
		}
		.tooltip.top {
			top: auto;
			bottom: 40px;
		}
		.noUi-active .tooltip {
			display: block;
		}

	</style>

	<link href="jquery.nouislider.css" rel="stylesheet">
	<script src="jquery.nouislider.js"></script>

	<script>
		var Link = $.noUiSlider.Link;
	</script>

	<link href="http://code.jquery.com/qunit/qunit-1.12.0.css" rel="stylesheet">
	<script src="http://code.jquery.com/qunit/qunit-1.12.0.js"></script>

</head>

<body>

	<div id="qunit"></div>
	<div id="qunit-fixture"></div>

	<script>
		var Q = $("#qunit-fixture");
	</script>

<script>

	test( "Generation of named inputs", function(){

		Q.html('\
			<form>\
				<div class="slider" id="slidera"></div>\
				<div class="slider" id="sliderb"></div>\
				<div class="slider" id="sliderc"></div>\
			</form>\
		');

		Q.find(".slider").noUiSlider({
			  range: {
				'min': [   0 ],
				'max': [ 100 ]
			}
			,start: [ 20, 80 ]
			,serialization: {
				 lower: [ new Link('lower') ]
				,upper: [ new Link('upper') ]
			}
		});

		$("#slidera").val([50, 61]);
		$("#sliderb").val([51, 62]);
		$("#sliderc").val([52, 63]);

		var inputs = Q.find('input');

		equal( inputs.length, 6, "Generated all inputs" );

		equal( $(inputs[0]).val(), '50.00' );
		equal( $(inputs[1]).val(), '61.00' );
		equal( $(inputs[2]).val(), '51.00' );
		equal( $(inputs[3]).val(), '62.00' );
		equal( $(inputs[4]).val(), '52.00' );
		equal( $(inputs[5]).val(), '63.00' );

	});

	test( "Shared link element", function(){

		Q.html('\
			<div class="slider" id="slidera"></div>\
			<div class="slider" id="sliderb"></div>\
			<span id="slider-span"></span>\
		');

		var span = $('#slider-span');

		var LinkEl =
			new Link( span, false, {
				 mark: ','
				,decimals: 1
				,thousand: '.'
				,encoder: function( decoded ){
					return decoded * 10000;
				}
				,decoder: function( encoded ){
					return encoded / 10000;
				}
			});

		$("#slidera, #sliderb").noUiSlider({
			 range: {
				'min': [ -20 ],
				'max': [  20 ]
			}
			,start: [ 0, 10 ]
			,behaviour: 'drag'
			,connect: true
			,serialization: {
				lower: [ LinkEl ]
			}
		});

		$("#sliderb").val( 1 );

		deepEqual( $("#slidera").val(), ['0.00', '10.00'] );
		equal( span.html(), '10.000,0' );

	});

	test( "Serialization and formatting options", function(){

		Q.html('\
			<div class="slider" id="slider"></div>\
			<input id="inputChange">\
			<input id="inputVal">\
			<span id="sliderspan"></span>\
		');

		function placeTooltip(value){
			$(this).text(value);
		}

		var tooltipLink =
			new Link( '-tooltip-<div class="tooltip"/>', function( value, handle, slider ){

				ok( $("#slider").is( slider ) );
				ok( handle.hasClass('noUi-handle') );

			}, {
				 decimals: 6
				,prefix: '#'
				,negativeBefore: '!'
				,negative: ''
			});

		var changeLink =
			new Link( $("#inputChange"), false, {
				 mark: '.'
				,thousand: ','
				,prefix: '$'
				,postfix: ' p.p.'
				,decimals: 3
				,negativeBefore: '-'
				,negative: ''
				,encoder: function( a ){
					return a * 1E7;
				}
				,decoder: function( a ){
					return a / 1E7;
				}
			});

		var valLink =
			new Link( $("#inputVal"), 'val' );

		$("#slider").noUiSlider({
			 range: {
				'min': [ 0.001 ],
				'max': [ 0.003 ]
			}
			,start: [ 0, 0.002 ]
			,connect: true
			,behaviour: 'drag'
			,serialization: {
				 lower: [ tooltipLink, changeLink ]
				,upper: [ valLink ]
				,format: {
					decimals: 5
				}
			}
		});

		$("#inputChange").val( "15000" ).trigger('change');

		equal( $("#inputChange").val(), "$15,000.000 p.p.", "Testing interpretation of improper data" );

		$("#inputVal").val( 3 );

		equal( $("#inputVal").val(), "3" );

		$("#inputVal").trigger("change");

		equal ( $("#inputVal").val(), "3", "Input doesn't respond to change events." );

		deepEqual( $("#slider").val(), ["0.00150", "0.00200"] );

	});

</script>

</body>
